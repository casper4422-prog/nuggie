<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>ü¶ï Dino Nuggie Manager</title>
        <link rel="stylesheet" href="main.css">
        <link rel="stylesheet" href="main-additional.css">
    </head>
    <body>
        <!-- Minimal app shell. All JS lives in external files. -->
        <div id="landingPage" class="landing-page" role="main">
            <div class="landing-container">
                <h1 class="landing-title">Dino Nuggie Manager</h1>
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="loginEmail">Email</label>
                        <input class="form-control" id="loginEmail" type="email" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Password</label>
                        <input class="form-control" id="loginPassword" type="password" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn btn-primary login-btn">Login</button>
                </form>
                <div class="login-link">Don't have an account? <a href="#" id="showRegisterLink">Register</a></div>
                <div id="loginError" class="login-error" role="status" aria-live="polite"></div>
            </div>
        </div>

        <div id="registerPage" class="register-page hidden" aria-hidden="true"></div>
        <div id="mainApp" class="hidden" aria-hidden="true">
            <header class="header"><div class="header-content"><div class="header-top">
                <div class="tribe-header" id="tribeHeader">My Tribe</div>
                <div class="header-actions">
                    <button class="btn btn-secondary" id="openTribeBtn">üèõÔ∏è Tribe Settings</button>
                    <button class="btn btn-secondary" id="goToCreaturesBtn">ü¶ñ Creatures</button>
                    <button class="btn btn-secondary" id="goToMyNuggiesBtn">üçó My Nuggies</button>
                    <button id="authBtn" class="btn btn-primary">Sign Out</button>
                </div>
            </div></div></header>
            <main id="appMainContent" role="main"></main>
        </div>

        <!-- Creature modals placeholders -->
        <div class="modal" id="creatureModal" aria-hidden="true"></div>
        <div class="modal" id="creatureDetailModal" aria-hidden="true"></div>

        <!-- Load species database first, then main app logic -->
        <script src="species-database.js"></script>
        <script src="main.js"></script>
    </body>
</html>
            const isHighestStat = (statName) => {
                if (!highestStats || !highestStats[statName] || !creature || !creature.id) {
                    return false;
                }
                return highestStats[statName].creatureId === creature.id;
            };

            // Check if we're in list view
            const grid = document.getElementById('creaturesGrid');
            const isListView = grid && grid.classList.contains('list-view');

            if (isListView) {
                // List view layout
                card.innerHTML = `
                    <div class="creature-card-header">
                        ${creature.image ? 
                            `<img src="${creature.image}" alt="${creature.name}" class="creature-image creature-image-list">` :
                            `<div class="creature-image-placeholder creature-image-list-placeholder">${SPECIES_DATABASE[creature.species]?.icon || 'ü¶ñ'}</div>`
                        }
                    </div>
                    <div class="creature-card-content">
                        <div class="creature-name">${creature.name}</div>
                        <div class="creature-meta">
                            <div class="list-view-stat">
                                <span>üìä</span>
                                <span>Lvl ${creature.level || 1}</span>
                            </div>
                            <div class="list-view-stat">
                                <span>${creature.gender === 'Male' ? '‚ôÇÔ∏è' : creature.gender === 'Female' ? '‚ôÄÔ∏è' : '‚ùì'}</span>
                                <span>${creature.gender || 'Unknown'}</span>
                            </div>
                            <div class="list-view-stat ${isHighestStat('Health') ? 'highest-stat' : ''}">
                                <span>‚ù§Ô∏è</span>
                                <span>${healthDisplay}</span>
                            </div>
                            <div class="list-view-stat ${isHighestStat('Stamina') ? 'highest-stat' : ''}">
                                <span>üèÉ</span>
                                <span>${staminaDisplay}</span>
                            </div>
                            <div class="list-view-stat ${isHighestStat('Oxygen') ? 'highest-stat' : ''}">
                                <span>üí®</span>
                                <span>${oxygenDisplay}</span>
                            </div>
                            <div class="list-view-stat ${isHighestStat('Food') ? 'highest-stat' : ''}">
                                <span>üçñ</span>
                                <span>${foodDisplay}</span>
                            </div>
                            <div class="list-view-stat ${isHighestStat('Weight') ? 'highest-stat' : ''}">
                                <span>‚öñÔ∏è</span>
                                <span>${weightDisplay}</span>
                            </div>
                            <div class="list-view-stat ${isHighestStat('Melee') ? 'highest-stat' : ''}">
                                <span>‚öîÔ∏è</span>
                                <span>${meleeDisplay}</span>
                            </div>
                        </div>
                        <div class="creature-badges">
                            ${badgeHTML}
                        </div>
                    </div>
                `;
            } else {
                // Card view layout (existing)
                card.innerHTML = `
                    <div class="creature-card-header">
                        ${creature.image ? 
                            `<img src="${creature.image}" alt="${creature.name}" class="creature-image">` :
                            `<div class="creature-image-placeholder">${SPECIES_DATABASE[creature.species]?.icon || 'ü¶ñ'}</div>`
                        }
                        <div class="creature-badges">
                            ${badgeHTML}
                        </div>
                    </div>
                    <div class="creature-card-content">
                        <div class="creature-name">${creature.name}</div>
                        <div class="creature-meta">
                            <span>Level ${creature.level || 1}</span>
                            <span>${creature.gender || 'Unknown'}</span>
                        </div>
                        <div class="creature-stats">
                            <div class="stat-item ${isHighestStat('Health') ? 'highest-stat' : ''}">
                                <div class="stat-label"><span class="stat-icon">‚ù§Ô∏è</span> Health</div>
                                <div class="stat-value">${healthDisplay}</div>
                            </div>
                            <div class="stat-item ${isHighestStat('Stamina') ? 'highest-stat' : ''}">
                                <div class="stat-label"><span class="stat-icon">üèÉ</span> Stamina</div>
                                <div class="stat-value">${staminaDisplay}</div>
                            </div>
                            <div class="stat-item ${isHighestStat('Oxygen') ? 'highest-stat' : ''}">
                                <div class="stat-label"><span class="stat-icon">üí®</span> Oxygen</div>
                                <div class="stat-value">${oxygenDisplay}</div>
                            </div>
                            <div class="stat-item ${isHighestStat('Food') ? 'highest-stat' : ''}">
                                <div class="stat-label"><span class="stat-icon">üçñ</span> Food</div>
                                <div class="stat-value">${foodDisplay}</div>
                            </div>
                            <div class="stat-item ${isHighestStat('Weight') ? 'highest-stat' : ''}">
                                <div class="stat-label"><span class="stat-icon">‚öñÔ∏è</span> Weight</div>
                                <div class="stat-value">${weightDisplay}</div>
                            </div>
                            <div class="stat-item ${isHighestStat('Melee') ? 'highest-stat' : ''}">
                                <div class="stat-label"><span class="stat-icon">‚öîÔ∏è</span> Melee</div>
                                <div class="stat-value">${meleeDisplay}</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            return card;
        }

        // Creature Modal Management
        function openCreatureModal(creature = null) {
            appState.editingCreature = creature?.id || null;
            
            // Reset form
            document.getElementById('creatureName').value = creature?.name || '';
            document.getElementById('creatureGender').value = creature?.gender || 'Male';
            document.getElementById('creatureLevel').value = creature?.level || '';
            
            // Base stats
            document.getElementById('baseStatHealth').value = creature?.baseStats?.Health || '';
            document.getElementById('baseStatStamina').value = creature?.baseStats?.Stamina || '';
            document.getElementById('baseStatOxygen').value = creature?.baseStats?.Oxygen || '';
            document.getElementById('baseStatFood').value = creature?.baseStats?.Food || '';
            document.getElementById('baseStatWeight').value = creature?.baseStats?.Weight || '';
            document.getElementById('baseStatMelee').value = creature?.baseStats?.Melee || '';
            
            // Mutations
            document.getElementById('healthMutations').value = creature?.mutations?.Health || '';
            document.getElementById('staminaMutations').value = creature?.mutations?.Stamina || '';
            document.getElementById('oxygenMutations').value = creature?.mutations?.Oxygen || '';
            document.getElementById('foodMutations').value = creature?.mutations?.Food || '';
            document.getElementById('weightMutations').value = creature?.mutations?.Weight || '';
            document.getElementById('meleeMutations').value = creature?.mutations?.Melee || '';
            
            // Domestic levels
            document.getElementById('healthLevels').value = creature?.domesticLevels?.Health || '';
            document.getElementById('staminaLevels').value = creature?.domesticLevels?.Stamina || '';
            document.getElementById('oxygenLevels').value = creature?.domesticLevels?.Oxygen || '';
            document.getElementById('foodLevels').value = creature?.domesticLevels?.Food || '';
            document.getElementById('weightLevels').value = creature?.domesticLevels?.Weight || '';
            document.getElementById('meleeLevels').value = creature?.domesticLevels?.Melee || '';
            
            document.getElementById('creatureNotes').value = creature?.notes || '';
            
            // Handle image
            const imagePreview = document.getElementById('imagePreview');
            if (creature?.image) {
                imagePreview.innerHTML = `<img src="${creature.image}" alt="Preview" class="image-upload-preview">`;
            } else {
                imagePreview.innerHTML = `
                    <div>üì∑</div>
                    <div class="upload-image-label">Upload Image</div>
                `;
            }
            
            document.getElementById('creatureModalTitle').textContent = creature ? 'Edit Creature' : 'Add Creature';
            document.getElementById('creatureModal').classList.add('active');
            updateBadgePreview();
        }

        function closeCreatureModal() {
            document.getElementById('creatureModal').classList.remove('active');
            appState.editingCreature = null;
        }

        function handleImageUpload(input) {
          const file = input.files[0];
          const imagePreview = document.getElementById('imagePreview');
          if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
              const result = e.target.result;
              if (typeof result === 'string' && result.startsWith('data:image')) {
                imagePreview.innerHTML = `<img src="${result}" alt="Preview" class="image-upload-preview">`;
              } else {
                imagePreview.innerHTML = `<div>üì∑</div><div class="upload-image-label">Upload Image</div>`;
              }
            };
            reader.readAsDataURL(file);
          } else {
            imagePreview.innerHTML = `<div>üì∑</div><div class="upload-image-label">Upload Image</div>`;
          }
        }

        function updateBadgePreview() {
            const creature = {
                baseStats: {
                    Health: parseInt(document.getElementById('baseStatHealth').value) || 0,
                    Stamina: parseInt(document.getElementById('baseStatStamina').value) || 0,
                    Food: parseInt(document.getElementById('baseStatFood').value) || 0,
                    Weight: parseInt(document.getElementById('baseStatWeight').value) || 0,
                    Melee: parseInt(document.getElementById('baseStatMelee').value) || 0
                }
            };

            const bloodline = BadgeSystem.calculatePrizedBloodline(creature);
            const previewContent = document.getElementById('badgePreviewContent');
            
            if (bloodline.qualified) {
                const badgeClass = `badge-${bloodline.tier}`;
                previewContent.innerHTML = `
                    <div class="badge ${badgeClass}">${bloodline.tier.toUpperCase()} BLOODLINE</div>
                    <span class="stat-info">Minimum stat: ${bloodline.minStat} points</span>
                `;
            } else {
                previewContent.innerHTML = `
                    <span class="no-badge-qualification">No badge qualification yet</span>
                    <span class="stat-info">‚Ä¢ Need all 5 core stats ‚â•45 for Bronze</span>
                `;
            }
        }

        function saveCreature() {
            const name = document.getElementById('creatureName').value.trim();
            if (!name) {
                alert('Please enter a creature name');
                return;
            }

            const imageInput = document.getElementById('creatureImage');
            const imageElement = document.querySelector('#imagePreview img');
            
            const creatureData = {
                id: appState.editingCreature || generateId(),
                name,
                species: appState.currentSpecies,
                gender: document.getElementById('creatureGender').value,
                level: parseInt(document.getElementById('creatureLevel').value) || 1,
                image: imageElement ? imageElement.src : null,
                baseStats: {
                    Health: parseInt(document.getElementById('baseStatHealth').value) || 0,
                    Stamina: parseInt(document.getElementById('baseStatStamina').value) || 0,
                    Oxygen: parseInt(document.getElementById('baseStatOxygen').value) || 0,
                    Food: parseInt(document.getElementById('baseStatFood').value) || 0,
                    Weight: parseInt(document.getElementById('baseStatWeight').value) || 0,
                    Melee: parseInt(document.getElementById('baseStatMelee').value) || 0
                },
                mutations: {
                    Health: parseInt(document.getElementById('healthMutations').value) || 0,
                    Stamina: parseInt(document.getElementById('staminaMutations').value) || 0,
                    Oxygen: parseInt(document.getElementById('oxygenMutations').value) || 0,
                    Food: parseInt(document.getElementById('foodMutations').value) || 0,
                    Weight: parseInt(document.getElementById('weightMutations').value) || 0,
                    Melee: parseInt(document.getElementById('meleeMutations').value) || 0
                },
                domesticLevels: {
                    Health: parseInt(document.getElementById('healthLevels').value) || 0,
                    Stamina: parseInt(document.getElementById('staminaLevels').value) || 0,
                    Oxygen: parseInt(document.getElementById('oxygenLevels').value) || 0,
                    Food: parseInt(document.getElementById('foodLevels').value) || 0,
                    Weight: parseInt(document.getElementById('weightLevels').value) || 0,
                    Melee: parseInt(document.getElementById('meleeLevels').value) || 0
                },
                notes: document.getElementById('creatureNotes').value,
                createdAt: appState.editingCreature ? 
                    appState.creatures.find(c => c.id === appState.editingCreature)?.createdAt || new Date().toISOString() :
                    new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            if (appState.editingCreature) {
                const index = appState.creatures.findIndex(c => c.id === appState.editingCreature);
                appState.creatures[index] = creatureData;
            } else {
                appState.creatures.push(creatureData);
            }

            saveData();
            closeCreatureModal();
            loadCreaturesGrid();
            loadSpeciesGrid();
            updateStatsDashboard();
        }

        // Creature Detail Modal
        function openCreatureDetailModal(creature) {
            appState.selectedCreature = creature;
            document.getElementById('creatureDetailTitle').textContent = creature.name;
            
            const badges = BadgeSystem.generateBadgeHTML(creature);
            const species = SPECIES_DATABASE[creature.species];
            
            document.getElementById('creatureDetailContent').innerHTML = `
                <div class="creature-detail-header">
                    <div class="creature-detail-image-col">
                        ${creature.image ? 
                            `<img src="${creature.image}" alt="${creature.name}" class="creature-detail-image">` :
                            `<div class="creature-detail-image-placeholder">${species?.icon || 'ü¶ñ'}</div>`
                        }
                    </div>
                    <div class="creature-detail-content-col">
                        <div class="creature-detail-title-row">
                            <h3 class="creature-detail-title">${creature.name}</h3>
                            <span class="creature-gender-badge">${creature.gender || 'Unknown'}</span>
                        </div>
                        <div class="creature-detail-badges-row">
                            ${badges}
                        </div>
                        <div class="creature-detail-meta">
                            <strong>Species:</strong> ${creature.species} ‚Ä¢ 
                            <strong>Level:</strong> ${creature.level || 1}
                        </div>
                        ${creature.notes ? `<div class="creature-detail-notes"><strong>Notes:</strong> ${creature.notes}</div>` : ''}
                    </div>
                </div>
                
                <div class="creature-detail-stats-grid">
                    <div>
                        <h4 class="creature-detail-stats-title">üìä Base Stats</h4>
                        ${generateStatTable(creature.baseStats)}
                    </div>
                    <div>
                        <h4 class="creature-detail-stats-title">üß¨ Mutations</h4>
                        ${generateStatTable(creature.mutations)}
                    </div>
                </div>
                
                <div class="creature-detail-domestic">
                    <h4 class="creature-detail-stats-title">üìà Domestic Levels</h4>
                    ${generateStatTable(creature.domesticLevels)}
                </div>
            `;
            
            document.getElementById('creatureDetailModal').classList.add('active');
        }

        function generateStatTable(stats) {
            if (!stats) return '<div class="stat-no-data">No data</div>';
            
            return `
                <div class="stat-table-grid">
                    ${Object.entries(stats).map(([stat, value]) => `
                        <div class="stat-table-cell">
                            <div class="stat-table-label">${stat}</div>
                            <div class="stat-table-value">${value || 0}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function closeCreatureDetailModal() {
            document.getElementById('creatureDetailModal').classList.remove('active');
            appState.selectedCreature = null;
        }

        function editCreature() {
            closeCreatureDetailModal();
            openCreatureModal(appState.selectedCreature);
        }

        function deleteCreature() {
            if (confirm(`Are you sure you want to delete ${appState.selectedCreature.name}?`)) {
                appState.creatures = appState.creatures.filter(c => c.id !== appState.selectedCreature.id);
                saveData();
                closeCreatureDetailModal();
                loadCreaturesGrid();
                loadSpeciesGrid();
                updateStatsDashboard();
            }
        }

        // Stats Dashboard
        function updateStatsDashboard() {
            const creatures = appState.creatures;
            const speciesCount = new Set(creatures.map(c => c.species)).size;
            const prizedCount = creatures.filter(c => BadgeSystem.calculatePrizedBloodline(c).qualified).length;
            const highestLevel = creatures.length > 0 ? Math.max(...creatures.map(c => c.level || 1)) : 1;
            
            document.getElementById('totalCreatures').textContent = creatures.length;
            document.getElementById('speciesTracked').textContent = speciesCount;
            document.getElementById('bossReadySpecies').textContent = '0'; // Placeholder
            document.getElementById('prizedBloodlines').textContent = prizedCount;
            document.getElementById('highestLevel').textContent = highestLevel;
        }

        // Data Management
        function generateId() {
            return 'creature_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function saveData() {
            localStorage.setItem('arkCreatures', JSON.stringify(appState.creatures));
        }

        // Initialize the application
  // Only use new SPA navigation logic
    </script>
</script>
<script src="main.js"></script>
</body>
</html>